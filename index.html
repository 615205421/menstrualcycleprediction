<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>花期</title><style>:root{--bg:#fff;--text:#000;--gray:#888;--line:#eee}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:30px 20px;display:flex;justify-content:center;-webkit-tap-highlight-color:transparent}.container{width:100%;max-width:360px}.header{margin-top:20px;border-bottom:1.5px solid var(--text);padding-bottom:40px;margin-bottom:40px}.label{font-size:.85rem;letter-spacing:2px;color:var(--gray);margin-bottom:5px}.days-number{font-size:5rem;font-weight:300;margin:10px 0;line-height:1}.prediction{font-size:.9rem;color:var(--gray);letter-spacing:.5px}.section{margin-bottom:45px}h3{font-size:.95rem;font-weight:600;margin-bottom:20px;letter-spacing:1px;border-left:3px solid var(--text);padding-left:10px}input[type=date],input[type=text]{width:100%;padding:12px 0;border:none;border-bottom:1px solid var(--line);font-size:1rem;border-radius:0;margin-bottom:20px;outline:0;background:0 0;-webkit-appearance:none;font-family:inherit}.btn{background:var(--text);color:#fff;border:none;padding:16px;width:100%;font-size:1rem;letter-spacing:4px;cursor:pointer;transition:.2s;font-family:inherit;margin-bottom:10px}.btn-sec{background:#fff;color:var(--text);border:1px solid var(--text);padding:12px;width:100%;font-size:.85rem;letter-spacing:2px;cursor:pointer;font-family:inherit}.btn:active,.btn-sec:active{opacity:.6}.row{display:flex;justify-content:space-between;font-size:.9rem;padding:12px 0;border-bottom:1px solid var(--line)}.history-item{padding:15px 0;border-bottom:1px dashed var(--line);font-size:.9rem}.history-main{display:flex;justify-content:space-between;margin-bottom:5px}.history-note{color:var(--gray);font-size:.8rem;line-height:1.4}.footer{margin-top:60px;text-align:center;font-size:.75rem;color:#bbb;cursor:pointer;padding-bottom:40px}</style></head><body><div class="container"><div class="header"><div class="label">预计下次还有</div><div class="days-number" id="daysBox">--</div><div class="prediction" id="predictDate">等待输入...</div></div><div class="section"><h3>新增记录</h3><input type="date" id="dateInput"><input type="text" id="noteInput" placeholder="备注（选填）" maxlength="50"><button class="btn" onclick="save()">确认记录</button><button id="remindBtn" class="btn-sec" style="display:none" onclick="setReminder()">添加到系统提醒 (提前1天)</button></div><div class="section"><h3>数据分析</h3><div class="row"><span style="color:var(--gray)">平均周期</span><span id="avgDisplay">-- 天</span></div><div class="row"><span style="color:var(--gray)">记录总数</span><span id="countDisplay">0 次</span></div></div><div class="section"><h3>历史记录</h3><div id="historyBox"></div></div><div class="footer" onclick="reset()">重置所有数据</div></div><script>let logs=JSON.parse(localStorage.getItem('my_p_logs_v2')||'[]');let nextPDate=null;function save(){const t=document.getElementById('dateInput').value,e=document.getElementById('noteInput').value;if(!t)return;if(logs.some(e=>e.date===t))return alert("日期已存在");logs.unshift({date:t,note:e});logs.sort((t,e)=>new Date(e.date)-new Date(t.date));localStorage.setItem('my_p_logs_v2',JSON.stringify(logs));document.getElementById('noteInput').value="";updateUI()}function getAvg(){if(logs.length<2)return 28;let t=0;for(let e=0;e<logs.length-1;e++)t+=(new Date(logs[e].date)-new Date(logs[e+1].date))/864e5;return Math.round(t/(logs.length-1))}function setReminder(){if(!nextPDate)return;const t=new Date(nextPDate);t.setDate(t.getDate()-1);const e=t.toISOString().replace(/-|:|\.\d+/g,""),n=`BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\nDTSTART:${e}\nDTEND:${e}\nSUMMARY:小助手提醒：大姨妈预计明天到访，记得带好用品哦~\nEND:VEVENT\nEND:VCALENDAR`,o=new Blob([n],{type:"text/calendar"}),a=document.createElement("a");a.href=URL.createObjectURL(o),a.download="period_remind.ics",a.click()}function updateUI(){const t=document.getElementById('historyBox'),e=document.getElementById('daysBox'),n=document.getElementById('predictDate'),o=document.getElementById('avgDisplay'),a=document.getElementById('countDisplay'),r=new Date;r.setHours(0,0,0,0);t.innerHTML=logs.slice(0,10).map(t=>`<div class="history-item"><div class="history-main"><span>${t.date}</span><span style="color:#999">记录</span></div>${t.note?`<div class="history-note">${t.note}</div>`:""}</div>`).join("");const i=getAvg();o.innerText=i+" 天",a.innerText=logs.length+" 次";if(logs.length>0){const s=new Date(logs[0].date),l=new Date(s);l.setDate(s.getDate()+i);nextPDate=l;const c=Math.ceil((l-r)/864e5);document.getElementById('remindBtn').style.display="block";if(c>0)e.innerText=c,e.style.fontSize="5rem",n.innerText=`预计：${l.getFullYear()}/${l.getMonth()+1}/${l.getDate()}`;else if(c>-7)e.innerText="进行中",e.style.fontSize="3rem",n.innerText="当前处于生理期阶段";else e.innerText="!",n.innerText=`已推迟 ${Math.abs(c)} 天`}}function reset(){confirm("确定要清空吗？")&&(localStorage.clear(),location.reload())}updateUI()</script></body></html>
